<div id="content">
    <div id="heading">
        Mission Settings
    </div>
    
    <div id="form-contents">

        <div class="form-box">
            <div class="subheading">Mission Configuration</div>

            <label for="name">Mission Name</label>
            <input type="text" placeholder="Enter Mission Name" name="name" id="name" value="%name%" title="Name of mission that will be displayed on the top menu bar." required>
            
            <label for="date-start">Mission Start & End Dates</label>
            <input type="text" placeholder="" name="date_start" id="date_start" value="%date_start%" required style="width: 49%; margin-right: 2px;" title="Date when the mission starts.">
            <input type="text" placeholder="" name="date_end"   id="date_end"   value="%date_end%"   required style="width: 49%;" title="Date when the mission ends.">
        </div>

        <div class="form-box">
            <div class="subheading">Communicaiton Delay</div>

            <label for="delay_is_manual">Manual Delay</label>
            <select name="delay_is_manual" id="delay_is_manual">
                <option value="1">Manual Delay Configuration</option>
                <option value="0">Automatic Delay Configuration</option>
            </select>

            <div id="delay_manual">
                <label for="manual_delay">Delay in Seconds</label>
                <input type="text" placeholder="Manual Delay in Seconds" name="manual_delay" id="manual_delay" value="%manual_delay%" required>
            </div>
            <div id="delay_auto">
                <label for="delay_auto_config">Piecewise Delay Definition in Sec</label>
                <div class="delay_config_row">
                    <input type="text" class="delay_met" placeholder="" name="delay_time[]" style="width: 35%;">
                    <input type="text" class="delay_cfg" placeholder="" name="delay_eq[]" style="width: 50%;">
                    <button type="button" class="add_delay_btn"><span class="ui-icon ui-icon-plusthick"></span></button>
                    <button type="button" class="del_delay_btn"><span class="ui-icon ui-icon-minusthick"></span></button>
                </div>
                <template id="delay_template">
                    <div class="delay_config_row">
                        <input type="text" class="delay_met" placeholder="" name="delay_time[]" style="width: 35%;">
                        <input type="text" class="delay_cfg" placeholder="" name="delay_eq[]" style="width: 50%;">
                        <button type="button" class="add_delay_btn"><span class="ui-icon ui-icon-plusthick"></span></button>
                        <button type="button" class="del_delay_btn"><span class="ui-icon ui-icon-minusthick"></span></button>
                    </div>
                </template>
            </div>
        </div>

        <div style="clear: both;"></div>

        <div class="form-box">
            <div class="subheading">Mission Control</div>

            <label for="mcc_name">Name for Mission Control</label>
            <input type="text" placeholder="Mission Control Name" name="mcc_name" id="mcc_name" value="%mcc_name%" required>

            <label for="mcc_planet">Planet for Mission Control</label>
            <input type="text" placeholder="Planet Name" name="mcc_planet" id="mcc_planet" value="%mcc_planet%" required>

            <label for="mcc_user_role">User Role for Mission Control Operators</label>
            <input type="text" placeholder="Role Name" name="mcc_user_role" id="mcc_user_role" value="%mcc_user_role%" required>

            <label for="mcc_timezone">Timezone for Mission Control</label>
            <select name="mcc_timezone" id="mcc_timezone">
                %mcc_timezone%
            </select>            
        </div>

        <div class="form-box">
            <div class="subheading">Analog Habitat</div>

            <label for="hab_name">Name for Analog Habitat</label>
            <input type="text" placeholder="Habitat Name" name="hab_name" id="hab_name" value="%hab_name%" required>

            <label for="hab_planet">Planet/Moon Name for Analog Habitat</label>
            <input type="text" placeholder="Planet Name" name="hab_planet" id="hab_planet" value="%hab_planet%" required>

            <label for="hab_user_role">User Role for Analog Astronauts</label>
            <input type="text" placeholder="Role Name" name="hab_user_role" id="hab_user_role" value="%hab_user_role%" required>

            <label for="hab_timezone">Timezone for Analog Simulation</label>
            <select name="hab_timezone" id="hab_timezone">
                %hab_timezone%
            </select>
        </div>

    </div>
</div>

<script>
var fromDate = $('#date_start').datepicker({
    defaultDate: '%date_start%',
    dateFormat: 'yy-mm-dd'
}).on('change', function() {
    toDate.datepicker('option', 'minDate', getDate(this));
}),
toDate = $('#date_end').datepicker({
    defaultDate: '%date_end%',
    dateFormat: 'yy-mm-dd'
}).on('change', function() {
    fromDate.datepicker('option', 'maxDate', getDate(this));
});

function getDate(element) {
    var date;
    try {
        date = $.datepicker.parseDate('yy-mm-dd', element.value);
    }
    catch(error) {
        date = null;
    }
    return date;
}

$(document).ready(function () {
  $("body").on("click", ".add_delay_btn", function (e) {
    var index = $(e.target).closest(".delay_config_row").length + 1;
    var cloned_el = $(e.target).closest(".delay_config_row").clone(true);

    $(e.target).closest(".delay_config_row").parent().last().append(cloned_el).find(".remove_node_btn_frm_field:not(:first)").prop("disabled", false);

    //change id
    $(e.target)
      .closest(".delay_config_row")
      .last()
      .find(".delay_cfg")
      .attr("id", "delay_config_" + index);

    $(e.target)
      .closest(".delay_config_row")
      .last()
      .find(".delay_met")
      .attr("id", "delay_met_" + index);

    console.log(cloned_el);
    //count++;

    $('body').find(".del_delay_btn:not(:first)").prop("disabled", false); 
    $('body').find(".del_delay_btn").first().prop("disabled", true); 
  });



  $("body").on("click", ".del_delay_btn", function () {
    $(this).closest(".delay_config_row").remove();
    console.log("success");
  });
});

$(document).ready(function() {
    $( document ).tooltip();
});

</script>

<!--
https://bootstrapfriendly.com/blog/dynamically-add-or-remove-form-input-fields-using-jquery/
-->
